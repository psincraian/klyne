{% extends "backoffice/layout.html" %}

{% block page_title %}API Keys{% endblock %}

{% block backoffice_content %}
<div class="mb-8">
    <h1 class="text-3xl font-bold text-base-content">API Keys</h1>
    <p class="text-base-content/70 mt-2">Monitor API key usage and manage access</p>
</div>

<div class="stats shadow mb-8 stats-vertical sm:stats-horizontal">
    <div class="stat">
        <div class="stat-title">Total API Keys</div>
        <div class="stat-value">{{ total_keys }}</div>
        <div class="stat-figure text-primary">
            <i class="fas fa-key text-2xl"></i>
        </div>
    </div>
    <div class="stat">
        <div class="stat-title">Unique Packages</div>
        <div class="stat-value">{{ unique_packages }}</div>
        <div class="stat-figure text-secondary">
            <i class="fas fa-box text-2xl"></i>
        </div>
    </div>
    <div class="stat">
        <div class="stat-title">This Month</div>
        <div class="stat-value">{{ keys_this_month }}</div>
        <div class="stat-figure text-success">
            <i class="fas fa-calendar-alt text-2xl"></i>
        </div>
    </div>
    <div class="stat">
        <div class="stat-title">This Week</div>
        <div class="stat-value">{{ keys_this_week }}</div>
        <div class="stat-figure text-info">
            <i class="fas fa-calendar-week text-2xl"></i>
        </div>
    </div>
</div>

<div class="overflow-x-auto">
    <table class="table table-zebra">
        <thead>
            <tr>
                <th>ID</th>
                <th>Package Name</th>
                <th>Key</th>
                <th>User</th>
                <th>Created</th>
                <th>Last Updated</th>
            </tr>
        </thead>
        <tbody>
            {% for api_key in api_keys %}
            <tr class="hover">
                <td class="font-mono">#{{ api_key.id }}</td>
                <td>
                    <span class="badge badge-secondary">{{ api_key.package_name }}</span>
                </td>
                <td>
                    <code class="bg-base-200 px-2 py-1 rounded text-sm font-mono">
                        {{ api_key.key[:15] }}...
                    </code>
                </td>
                <td>
                    <div class="flex items-center gap-2">
                        <span>{{ api_key.user.email if api_key.user else 'Unknown' }}</span>
                        {% if api_key.user and api_key.user.is_admin %}
                            <span class="badge badge-info badge-sm">Admin</span>
                        {% endif %}
                    </div>
                </td>
                <td class="font-mono text-sm">{{ api_key.created_at.strftime('%Y-%m-%d %H:%M') if api_key.created_at else '-' }}</td>
                <td class="font-mono text-sm">{{ api_key.updated_at.strftime('%Y-%m-%d %H:%M') if api_key.updated_at else '-' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if not api_keys %}
<div class="text-center py-12 text-base-content/60">
    <i class="fas fa-key text-5xl mb-4 opacity-50"></i>
    <p class="text-lg">No API keys found.</p>
</div>
{% endif %}
{% endblock %}